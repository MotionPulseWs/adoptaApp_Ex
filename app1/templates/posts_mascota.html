{% extends 'layout.html' %}

{% block content %}
<div class="container mt-4">

    <!-- =========================================================
         SECCIÓN: TÍTULO Y DATOS PRINCIPALES DE LA MASCOTA
         ========================================================= -->
    <h2>Galería de {{ mascota.nombre }}</h2>

    <hr>

    <!-- =========================================================
         SECCIÓN: LISTA / GALERÍA DE POSTS DE LA MASCOTA
         ========================================================= -->
    <div class="row">
        {% for post in posts %}
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm">
                    {% if post.foto %}
                        <img src="{{ post.foto.url }}" class="card-img-top" alt="{{ post.titulo }}" style="height: 220px; object-fit: cover;">
                    {% else %}
                        <div class="bg-light text-center py-5" style="height: 220px;">
                            <small class="text-muted">Sin foto</small>
                        </div>
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ post.titulo }}</h5>
                        <p class="text-muted small"><strong>Fecha:</strong> {{ post.fecha|date:"d/m/Y" }}</p>
                        <p class="card-text mt-2">{{ post.descripcion }}</p>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    <p>Aún no hay momentos publicados para {{ mascota.nombre }}.</p>
                    <p>¡Sé el primero en agregar uno!</p>
                </div>
            </div>
        {% endfor %}
    </div>


    <!-- =========================================================
         SECCIÓN: FORMULARIO PARA CREAR NUEVOS POSTS
         ========================================================= -->
    <hr class="mt-5 mb-4">

    <h3>Registrar nuevo momento / publicación</h3>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Mostrar errores generales del formulario -->
        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
        {% endif %}

        <!-- Campos del formulario con estilo Bootstrap -->
        <div class="mb-3">
            {{ form.titulo.label_tag }}
            {{ form.titulo }}
            {% if form.titulo.errors %}
                <div class="text-danger small">{{ form.titulo.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.descripcion.label_tag }}
            {{ form.descripcion }}
            {% if form.descripcion.errors %}
                <div class="text-danger small">{{ form.descripcion.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.fecha.label_tag }}
            {{ form.fecha }}
            {% if form.fecha.errors %}
                <div class="text-danger small">{{ form.fecha.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.foto.label_tag }}
            {{ form.foto }}
            {% if form.foto.errors %}
                <div class="text-danger small">{{ form.foto.errors }}</div>
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary mt-3">Guardar publicación</button>
    </form>


    <!-- =========================================================
         SECCIÓN: BOTÓN PARA VOLVER
         ========================================================= -->
    <a href="{% url 'home' %}" class="btn btn-secondary mt-4">Volver a inicio</a>

</div>
{% endblock %}